(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{787:function(e,r,t){Promise.resolve().then(t.bind(t,6803))},6803:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var a=t(7437),s=t(2265),n=t(5946),l=t(6235),d=e=>{let{message:r,onDelete:t}=e,[d,i]=(0,s.useState)(!1),o=async()=>{if(confirm("\xbfEst\xe1s seguro de que deseas eliminar este mensaje?")){i(!0);try{await (0,n.gD)(r.id),t()}catch(e){console.error("Error al eliminar mensaje:",e),alert("Error al eliminar el mensaje")}finally{i(!1)}}};return(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:r.phoneNumber}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"sent":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}})(r.status)),children:(e=>{switch(e){case"pending":return"Pendiente";case"sent":return"Enviado";case"error":return"Error";default:return e}})(r.status)}),"unique"!==r.type&&(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"daily"===r.type?"Diario":"biweekly"===r.type?"Cada 2 semanas":"Mensual"})]}),(0,a.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:r.message}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Programado para:"})," ",(0,l.WU)(r.scheduledDate,"dd/MM/yyyy 'a las' HH:mm")]}),r.sentAt&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Enviado:"})," ",(0,l.WU)(r.sentAt,"dd/MM/yyyy 'a las' HH:mm")]}),r.errorMessage&&(0,a.jsxs)("p",{className:"text-red-600 dark:text-red-400",children:[(0,a.jsx)("span",{className:"font-medium",children:"Error:"})," ",r.errorMessage]})]})]}),"pending"===r.status&&(0,a.jsx)("button",{onClick:o,disabled:d,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 disabled:opacity-50","aria-label":"Eliminar mensaje",children:d?"Eliminando...":"Eliminar"})]})})},i=t(8116),o=t(8407),c=()=>{let[e,r]=(0,s.useState)(null),[t,n]=(0,s.useState)(!1),[l,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),m=async()=>{if(o.w)try{let e=(0,i.V1)(o.w,"getWhatsAppStatus"),t=(await e()).data;t.connected?(d(!0),r(null),u(null),g(!1)):t.qr?(d(!1),r(t.qr),u(null),g(!1)):(d(!1),r(null))}catch(e){console.error("Error al verificar estado:",e)}},b=async()=>{if(!o.w){u("Functions no est\xe1 disponible");return}try{g(!0),n(!0),u(null);let e=(0,i.V1)(o.w,"initializeWhatsApp"),t=(await e()).data;if(t.error)u(t.error),d(!1),r(null),n(!1),g(!1);else if(t.connected)d(!0),r(null),u(null),n(!1),g(!1);else if(t.qr)r(t.qr),d(!1),u(null),n(!1),g(!1);else if(t.message&&t.message.includes("Inicializando")){g(!0),n(!0),u(null);let e=0,t=setInterval(async()=>{if(e++,!o.w){clearInterval(t),n(!1),g(!1),u("Functions no est\xe1 disponible");return}try{let a=(0,i.V1)(o.w,"getWhatsAppStatus"),s=(await a()).data;s.connected?(d(!0),r(null),u(null),n(!1),g(!1),clearInterval(t)):s.qr?(r(s.qr),d(!1),u(null),n(!1),g(!1),clearInterval(t)):e>=30&&(clearInterval(t),n(!1),g(!1),u("La inicializaci\xf3n est\xe1 tardando demasiado. Intenta de nuevo."))}catch(r){console.error("Error en polling:",r),e>=30&&(clearInterval(t),n(!1),g(!1),u("Error al verificar el estado. Intenta de nuevo."))}},2e3)}else u("No se pudo generar el c\xf3digo QR. Intenta de nuevo."),n(!1),g(!1)}catch(e){console.error("Error al inicializar WhatsApp:",e),u(e.message||"Error al inicializar WhatsApp. Verifica que las Functions est\xe9n desplegadas."),n(!1),g(!1)}};return((0,s.useEffect)(()=>{m();let e=setInterval(m,5e3);return()=>clearInterval(e)},[]),l)?(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6 text-center",children:[(0,a.jsx)("div",{className:"text-green-600 dark:text-green-400 font-semibold mb-2",children:"✓ WhatsApp conectado"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tu cuenta de WhatsApp est\xe1 vinculada y lista para enviar mensajes."}),(0,a.jsx)("button",{onClick:b,className:"mt-4 px-4 py-2 text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Reconectar"})]}):(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Conectar WhatsApp"}),c&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-red-600 dark:text-red-400 text-sm",children:c}),e?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Escanea este c\xf3digo QR con WhatsApp:"}),(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)("img",{src:e,alt:"QR Code",className:"border border-gray-300 dark:border-gray-600 rounded"})}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["1. Abre WhatsApp en tu tel\xe9fono",(0,a.jsx)("br",{}),"2. Ve a Configuraci\xf3n → Dispositivos vinculados",(0,a.jsx)("br",{}),'3. Toca "Vincular un dispositivo"',(0,a.jsx)("br",{}),"4. Escanea este c\xf3digo QR"]})]}):(0,a.jsx)("div",{className:"text-center",children:x||t?(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Inicializando WhatsApp..."}),(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Esto puede tardar unos segundos"})]}):c?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Inicia la conexi\xf3n con WhatsApp"}),(0,a.jsx)("button",{onClick:b,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Generar c\xf3digo QR"})]})})]})};function u(){let[e,r]=(0,s.useState)([]),[t,l]=(0,s.useState)("all");(0,s.useEffect)(()=>{let e=(0,n.PO)(e=>{r(e)});return()=>e()},[]);let i=e.filter(e=>"all"===t||e.status===t),o=e.filter(e=>"pending"===e.status),u=e.filter(e=>"sent"===e.status);return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"WhatsApp Scheduler"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Programa y env\xeda mensajes de WhatsApp autom\xe1ticamente"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(c,{})}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>l("all"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("all"===t?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600"),children:["Todos (",e.length,")"]}),(0,a.jsxs)("button",{onClick:()=>l("pending"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("pending"===t?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600"),children:["Pendientes (",o.length,")"]}),(0,a.jsxs)("button",{onClick:()=>l("sent"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("sent"===t?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600"),children:["Enviados (",u.length,")"]})]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/create.html",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors",children:"+ Nuevo Mensaje"})]}),0===i.length?(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-12 text-center border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:["No hay mensajes ","all"!==t&&"pending"===t?"pendientes":"sent"===t?"enviados":""]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/create.html",className:"mt-4 inline-block text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Crear tu primer mensaje programado"})]}):(0,a.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,a.jsx)(d,{message:e,onDelete:()=>{r(r=>r.filter(r=>r.id!==e.id))}},e.id))})]})})}},8407:function(e,r,t){"use strict";let a,s,n;t.d(r,{db:function(){return s},w:function(){return n}});var l=t(5236),d=t(9842),i=t(8116);(a=(0,l.C6)().length?(0,l.C6)()[0]:(0,l.ZF)({apiKey:"AIzaSyC_BrUol1kheBg5rRrwGPFbCDx5HMf7pkA",authDomain:"whatsapp-scheduler-2105b.firebaseapp.com",projectId:"whatsapp-scheduler-2105b",storageBucket:"whatsapp-scheduler-2105b.firebasestorage.app",messagingSenderId:"890959892342",appId:"1:890959892342:web:7f2dbe877f50460485f457"}))&&(s=(0,d.ad)(a),n=(0,i.$C)(a))},5946:function(e,r,t){"use strict";t.d(r,{PO:function(){return i},PV:function(){return l},gD:function(){return d}});var a=t(9842),s=t(8407);let n="scheduledMessages",l=async e=>{if(!s.db)throw Error("Firebase no est\xe1 inicializado");let r=new Date("".concat(e.scheduledDate,"T").concat(e.scheduledTime)),t={phoneNumber:e.phoneNumber,message:e.message,scheduledDate:a.EK.fromDate(r),type:e.type,status:"pending",createdAt:a.EK.now()};return(await (0,a.ET)((0,a.hJ)(s.db,n),t)).id},d=async e=>{if(!s.db)throw Error("Firebase no est\xe1 inicializado");await (0,a.oe)((0,a.JU)(s.db,n,e))},i=e=>{if(!s.db)return console.error("Firebase no est\xe1 inicializado"),()=>{};let r=(0,a.IO)((0,a.hJ)(s.db,n),(0,a.Xo)("scheduledDate","asc"));return(0,a.cf)(r,r=>{e(r.docs.map(e=>{var r;let t=e.data();return{id:e.id,phoneNumber:t.phoneNumber,message:t.message,scheduledDate:t.scheduledDate.toDate(),type:t.type,status:t.status,createdAt:t.createdAt.toDate(),sentAt:null===(r=t.sentAt)||void 0===r?void 0:r.toDate(),errorMessage:t.errorMessage}}))})}}},function(e){e.O(0,[358,33,235,971,23,744],function(){return e(e.s=787)}),_N_E=e.O()}]);